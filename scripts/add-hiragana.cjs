const fs = require('fs');

const examples = JSON.parse(fs.readFileSync('./static/data/examples.json', 'utf8'));

// 熟語の読み辞書（熟語→各漢字の読み）
const compoundReadings = {
  '左右': { '左': 'さ', '右': 'ゆう' },
  '上下': { '上': 'じょう', '下': 'げ' },
  '大雨': { '大': 'おお', '雨': 'あめ' },
  '女王': { '女': 'じょ', '王': 'おう' },
  '足音': { '足': 'あし', '音': 'おと' },
  '花火': { '花': 'はな', '火': 'び' },
  '目玉': { '目': 'め', '玉': 'だま' },
  '人口': { '人': 'じん', '口': 'こう' },
  '学校': { '学': 'がっ', '校': 'こう' },
  '天気': { '天': 'てん', '気': 'き' },
  '休日': { '休': 'きゅう', '日': 'じつ' },
  '空気': { '空': 'くう', '気': 'き' },
  '子犬': { '子': 'こ', '犬': 'いぬ' },
  '花見': { '花': 'はな', '見': 'み' },
  '火山': { '火': 'か', '山': 'ざん' },
  '正月': { '正': 'しょう', '月': 'がつ' },
  '先生': { '先': 'せん', '生': 'せい' },
  '青空': { '青': 'あお', '空': 'ぞら' },
  '夕日': { '夕': 'ゆう', '日': 'ひ' },
  '白紙': { '白': 'はく', '紙': 'し' },
  '山川': { '山': 'やま', '川': 'かわ' },
  '早朝': { '早': 'そう', '朝': 'ちょう' },
  '草花': { '草': 'くさ', '花': 'ばな' },
  '村人': { '村': 'むら', '人': 'びと' },
  '大人': { '大': 'おと', '人': 'な' },
  '男女': { '男': 'だん', '女': 'じょ' },
  '竹林': { '竹': 'ちく', '林': 'りん' },
  '町人': { '町': 'ちょう', '人': 'にん' },
  '雨天': { '雨': 'う', '天': 'てん' },
  '水田': { '水': 'すい', '田': 'でん' },
  '作文': { '作': 'さく', '文': 'ぶん' },
  '日本': { '日': 'に', '本': 'ほん' },
  '名人': { '名': 'めい', '人': 'じん' },
  '有名': { '有': 'ゆう', '名': 'めい' },
  '文字': { '文': 'も', '字': 'じ' },
  '電車': { '電': 'でん', '車': 'しゃ' },
  '上手': { '上': 'じょう', '手': 'ず' },
  '出口': { '出': 'で', '口': 'ぐち' },
  '入口': { '入': 'いり', '口': 'ぐち' },
  '森林': { '森': 'しん', '林': 'りん' },
  '校庭': { '校': 'こう', '庭': 'てい' },
  '校長': { '校': 'こう', '長': 'ちょう' },
  '男子': { '男': 'だん', '子': 'し' },
  '女子': { '女': 'じょ', '子': 'し' },
  '一月': { '一': 'いち', '月': 'がつ' },
  '二月': { '二': 'に', '月': 'がつ' },
  '三月': { '三': 'さん', '月': 'がつ' },
  '四月': { '四': 'し', '月': 'がつ' },
  '五月': { '五': 'ご', '月': 'がつ' },
  '六月': { '六': 'ろく', '月': 'がつ' },
  '七月': { '七': 'しち', '月': 'がつ' },
  '八月': { '八': 'はち', '月': 'がつ' },
  '九月': { '九': 'く', '月': 'がつ' },
  '十月': { '十': 'じゅう', '月': 'がつ' },
  '百円': { '百': 'ひゃく', '円': 'えん' },
  '千円': { '千': 'せん', '円': 'えん' },
  '千人': { '千': 'せん', '人': 'にん' },
  '百人': { '百': 'ひゃく', '人': 'にん' },
  '三人': { '三': 'さん', '人': 'にん' },
  '小学校': { '小': 'しょう', '学': 'がっ', '校': 'こう' },
  '中学校': { '中': 'ちゅう', '学': 'がっ', '校': 'こう' },
  '一年生': { '一': 'いち', '年': 'ねん', '生': 'せい' },
  '一日中': { '一': 'いち', '日': 'にち', '中': 'じゅう' }
};

// 完全なひらがな版を定義
// 形式: "sentence": "hiragana"
const hiraganaMap = {
  // 一
  "一つ ください。": "ひとつ ください。",
  "一月は さむい。": "いちがつは さむい。",
  // 右
  "右に まがる。": "みぎに まがる。",
  "左右を みる。": "さゆうを みる。",
  // 雨
  "雨が ふる。": "あめが ふる。",
  "大雨が きた。": "おおあめが きた。",
  // 円
  "円い つき。": "まるい つき。",
  "百円 ください。": "ひゃくえん ください。",
  // 王
  "王さまが いる。": "おうさまが いる。",
  "女王の くに。": "じょおうの くに。",
  // 音
  "音が する。": "おとが する。",
  "足音が きこえる。": "あしおとが きこえる。",
  // 下
  "下に おりる。": "したに おりる。",
  "上下に うごく。": "じょうげに うごく。",
  // 火
  "火を つける。": "ひを つける。",
  "火を けす。": "ひを けす。",
  "花火が きれい。": "はなびが きれい。",
  // 花
  "花が さく。": "はなが さく。",
  // 貝
  "貝を ひろう。": "かいを ひろう。",
  "大きな 貝だ。": "おおきな かいだ。",
  // 学
  "学校に いく。": "がっこうに いく。",
  "字を 学ぶ。": "じを まなぶ。",
  // 気
  "気を つける。": "きを つける。",
  "天気が いい。": "てんきが いい。",
  // 休
  "休む。": "やすむ。",
  "すこし 休む。": "すこし やすむ。",
  "休日は たのしい。": "きゅうじつは たのしい。",
  // 玉
  "玉を なげる。": "たまを なげる。",
  "きれいな 玉。": "きれいな たま。",
  "目玉が おおきい。": "めだまが おおきい。",
  // 金
  "金いろの かみ。": "きんいろの かみ。",
  "お金を はらう。": "おかねを はらう。",
  "金よう日だ。": "きんようびだ。",
  // 九
  "九つ ある。": "ここのつ ある。",
  "九月に なる。": "くがつに なる。",
  // 空
  "空が あおい。": "そらが あおい。",
  "空気が きれい。": "くうきが きれい。",
  // 月
  "月が でた。": "つきが でた。",
  "月が きれい。": "つきが きれい。",
  // 犬
  "犬が ほえる。": "いぬが ほえる。",
  "犬と あそぶ。": "いぬと あそぶ。",
  "子犬が かわいい。": "こいぬが かわいい。",
  // 見
  "見る。": "みる。",
  "山を 見る。": "やまを みる。",
  "花見に いく。": "はなみに いく。",
  // 五
  "五つ ある。": "いつつ ある。",
  "五つ ください。": "いつつ ください。",
  "五月に なる。": "ごがつに なる。",
  "五月は あたたかい。": "ごがつは あたたかい。",
  // 口
  "口を あける。": "くちを あける。",
  "人口が おおい。": "じんこうが おおい。",
  // 校
  "校庭で あそぶ。": "こうていで あそぶ。",
  "校長せんせい。": "こうちょうせんせい。",
  // 左
  "左に まがる。": "ひだりに まがる。",
  // 三
  "三つ ある。": "みっつ ある。",
  "三月に なる。": "さんがつに なる。",
  "三月に なった。": "さんがつに なった。",
  "三人で あそぶ。": "さんにんで あそぶ。",
  // 山
  "山に のぼる。": "やまに のぼる。",
  "火山を みる。": "かざんを みる。",
  "火山を みた。": "かざんを みた。",
  // 四
  "四つ ある。": "よっつ ある。",
  "四つ ください。": "よっつ ください。",
  "四月に なる。": "しがつに なる。",
  // 子
  "子どもが あそぶ。": "こどもが あそぶ。",
  "子どもが いる。": "こどもが いる。",
  "元気な 子ども。": "げんきな こども。",
  "男子と 女子。": "だんしと じょし。",
  // 糸
  "糸を つむぐ。": "いとを つむぐ。",
  "糸を きる。": "いとを きる。",
  "赤い 糸。": "あかい いと。",
  "赤い 糸だ。": "あかい いとだ。",
  // 字
  "字を かく。": "じを かく。",
  "大きな 字で。": "おおきな じで。",
  "文字を よむ。": "もじを よむ。",
  // 耳
  "耳が いい。": "みみが いい。",
  "耳が おおきい。": "みみが おおきい。",
  "耳を すます。": "みみを すます。",
  // 七
  "七つ ある。": "ななつ ある。",
  "七月に なる。": "しちがつに なる。",
  "七月は あつい。": "しちがつは あつい。",
  // 車
  "車に のる。": "くるまに のる。",
  "電車が くる。": "でんしゃが くる。",
  "電車に のる。": "でんしゃに のる。",
  // 手
  "手を あらう。": "てを あらう。",
  "上手に できた。": "じょうずに できた。",
  "上手に かく。": "じょうずに かく。",
  "上手に かける。": "じょうずに かける。",
  // 十
  "十こ ある。": "じゅっこ ある。",
  "十 かぞえる。": "じゅう かぞえる。",
  "十月に なる。": "じゅうがつに なる。",
  // 出
  "出る。": "でる。",
  "外に 出る。": "そとに でる。",
  "出口は どこ。": "でぐちは どこ。",
  // 女
  "女の子。": "おんなのこ。",
  "女の子が いる。": "おんなのこが いる。",
  "女王の くに。": "じょおうの くに。",
  // 小
  "小さい いぬ。": "ちいさい いぬ。",
  "小学校に いく。": "しょうがっこうに いく。",
  // 上
  "上に のぼる。": "うえに のぼる。",
  "上に あがる。": "うえに あがる。",
  "上下に うごく。": "じょうげに うごく。",
  // 森
  "森を あるく。": "もりを あるく。",
  "森林が ひろい。": "しんりんが ひろい。",
  // 人
  "人が いる。": "ひとが いる。",
  "人口が おおい。": "じんこうが おおい。",
  // 水
  "水を のむ。": "みずを のむ。",
  "水よう日だ。": "すいようびだ。",
  // 正
  "正しい。": "ただしい。",
  "正しい こたえ。": "ただしい こたえ。",
  "正月が くる。": "しょうがつが くる。",
  "お正月だ。": "おしょうがつだ。",
  // 生
  "生きる。": "いきる。",
  "花が 生える。": "はなが はえる。",
  "一年生に なる。": "いちねんせいに なる。",
  // 青
  "青い そら。": "あおい そら。",
  "空が 青い。": "そらが あおい。",
  "青空が きれい。": "あおぞらが きれい。",
  // 夕
  "夕がた。": "ゆうがた。",
  "夕方に かえる。": "ゆうがたに かえる。",
  "夕日が きれい。": "ゆうひが きれい。",
  // 石
  "石を なげる。": "いしを なげる。",
  "石を ひろう。": "いしを ひろう。",
  "石ころが ある。": "いしころが ある。",
  "大きな 石だ。": "おおきな いしだ。",
  // 赤
  "赤い りんご。": "あかい りんご。",
  "赤い 花。": "あかい はな。",
  "赤ちゃんが ないた。": "あかちゃんが ないた。",
  "赤ちゃんが いる。": "あかちゃんが いる。",
  // 千
  "千円 ください。": "せんえん ください。",
  "千人 いる。": "せんにん いる。",
  "千人も いる。": "せんにんも いる。",
  // 川
  "川で あそぶ。": "かわで あそぶ。",
  "川の みず。": "かわの みず。",
  "山川の けしき。": "やまかわの けしき。",
  // 先
  "先に いく。": "さきに いく。",
  "先生が くる。": "せんせいが くる。",
  "先生に あう。": "せんせいに あう。",
  // 早
  "早く おきる。": "はやく おきる。",
  "早朝に でる。": "そうちょうに でる。",
  "早朝に おきる。": "そうちょうに おきる。",
  // 草
  "草が はえる。": "くさが はえる。",
  "草むらに いる。": "くさむらに いる。",
  "草花が きれい。": "くさばなが きれい。",
  // 足
  "足が はやい。": "あしが はやい。",
  "足りない。": "たりない。",
  "足音が する。": "あしおとが する。",
  // 村
  "村に すむ。": "むらに すむ。",
  "村人が いる。": "むらびとが いる。",
  "村人に あう。": "むらびとに あう。",
  // 大
  "大きい いえ。": "おおきい いえ。",
  "大きい 山。": "おおきい やま。",
  "大人に なる。": "おとなに なる。",
  // 男
  "男の子。": "おとこのこ。",
  "男の子が いる。": "おとこのこが いる。",
  "男女で あそぶ。": "だんじょで あそぶ。",
  // 竹
  "竹を きる。": "たけを きる。",
  "竹が ある。": "たけが ある。",
  "竹やぶが ある。": "たけやぶが ある。",
  "竹林を あるく。": "ちくりんを あるく。",
  // 中
  "中に はいる。": "なかに はいる。",
  "中学校に いく。": "ちゅうがっこうに いく。",
  "一日中 あそぶ。": "いちにちじゅう あそぶ。",
  // 虫
  "虫を つかまえる。": "むしを つかまえる。",
  "虫が とぶ。": "むしが とぶ。",
  "虫を みる。": "むしを みる。",
  "大きな 虫だ。": "おおきな むしだ。",
  // 町
  "町を あるく。": "まちを あるく。",
  "町の なか。": "まちの なか。",
  "町人が いる。": "ちょうにんが いる。",
  // 天
  "天きが いい。": "てんきが いい。",
  "雨天で 中止。": "うてんで ちゅうし。",
  "天の川。": "あまのがわ。",
  // 田
  "田んぼで はたらく。": "たんぼで はたらく。",
  "田んぼが ある。": "たんぼが ある。",
  "田うえを する。": "たうえを する。",
  "水田が ひろい。": "すいでんが ひろい。",
  // 土
  "土を ほる。": "つちを ほる。",
  "土よう日だ。": "どようびだ。",
  // 二
  "二つ ある。": "ふたつ ある。",
  "二月に なる。": "にがつに なる。",
  "二月は さむい。": "にがつは さむい。",
  // 日
  "日が でる。": "ひが でる。",
  "日が のぼる。": "ひが のぼる。",
  "日よう日だ。": "にちようびだ。",
  "日よう日は やすみ。": "にちようびは やすみ。",
  // 入
  "入る。": "はいる。",
  "中に 入る。": "なかに はいる。",
  "入口は どこ。": "いりぐちは どこ。",
  // 年
  "年を とる。": "としを とる。",
  // 白
  "白い ゆき。": "しろい ゆき。",
  "白い くも。": "しろい くも。",
  "白紙に かく。": "はくしに かく。",
  // 八
  "八つ ある。": "やっつ ある。",
  "八月に なる。": "はちがつに なる。",
  "八月は あつい。": "はちがつは あつい。",
  // 百
  "百こ ある。": "ひゃっこ ある。",
  "百人も いる。": "ひゃくにんも いる。",
  // 文
  "文を かく。": "ぶんを かく。",
  "作文を かく。": "さくぶんを かく。",
  // 木
  "木に のぼる。": "きに のぼる。",
  "木よう日だ。": "もくようびだ。",
  // 本
  "本を よむ。": "ほんを よむ。",
  "日本に すむ。": "にほんに すむ。",
  // 名
  "名まえを かく。": "なまえを かく。",
  "名人に なる。": "めいじんに なる。",
  "有名な ひと。": "ゆうめいな ひと。",
  // 目
  "目を あける。": "めを あける。",
  "目が おおきい。": "めが おおきい。",
  "目玉やき。": "めだまやき。",
  "目玉が まるい。": "めだまが まるい。",
  // 立
  "立つ。": "たつ。",
  "立って まつ。": "たって まつ。",
  "立ち上がる。": "たちあがる。",
  // 力
  "力が ある。": "ちからが ある。",
  "力が つよい。": "ちからが つよい。",
  "力もちだ。": "ちからもちだ。",
  // 林
  "林を あるく。": "はやしを あるく。",
  "林の なか。": "はやしの なか。",
  // 六
  "六つ ある。": "むっつ ある。",
  "六月に なる。": "ろくがつに なる。"
};

// ひらがなかどうか判定
function isHiragana(char) {
  return /[ぁ-ん]/.test(char);
}

// 漢字かどうか判定
function isKanji(char) {
  return /[\u4e00-\u9faf]/.test(char);
}

// ひらがな版からルビを生成する関数（改良版）
function generateRubyFromHiragana(sentence, hiragana, targetKanji) {
  if (!hiragana) return sentence;

  // 文字位置のマッピングを作成
  // 漢字の開始位置と終了位置を特定
  const result = [];
  let sIdx = 0;
  let hIdx = 0;

  while (sIdx < sentence.length) {
    const sChar = sentence[sIdx];

    if (isKanji(sChar)) {
      // 連続する漢字を集める
      let kanjiSeq = sChar;
      let kanjiEndIdx = sIdx + 1;
      while (kanjiEndIdx < sentence.length && isKanji(sentence[kanjiEndIdx])) {
        kanjiSeq += sentence[kanjiEndIdx];
        kanjiEndIdx++;
      }

      // 対応するひらがな部分を見つける
      // 次の非ひらがな文字（または文末）まで
      const hStart = hIdx;
      let hEnd = hIdx;

      // ひらがな版で次の一致する文字を探す
      const nextNonKanjiChar = sentence[kanjiEndIdx]; // 漢字列の次の文字

      if (nextNonKanjiChar) {
        // 次の文字がひらがな版で見つかるまでスキップ
        while (hEnd < hiragana.length && hiragana[hEnd] !== nextNonKanjiChar) {
          hEnd++;
        }
      } else {
        // 文末まで
        hEnd = hiragana.length;
      }

      const readingSeq = hiragana.slice(hStart, hEnd);

      // 各漢字にルビを割り当て
      // 単純化: 漢字が1文字なら全読み、複数なら均等割り（または全体に適用）
      if (kanjiSeq.length === 1) {
        // 1文字の漢字
        if (sChar === targetKanji) {
          result.push(sChar); // 対象漢字はルビなし
        } else {
          result.push(sChar + '[' + readingSeq + ']');
        }
      } else {
        // 複数漢字の熟語
        // 各漢字に個別のルビを付けるのは難しいので、
        // 対象漢字以外にはまとめてルビを付ける
        for (let i = 0; i < kanjiSeq.length; i++) {
          const k = kanjiSeq[i];
          if (k === targetKanji) {
            result.push(k);
          } else {
            // 熟語内の他の漢字にはルビを付けない（複雑になるため）
            // または、熟語全体としてルビを付ける方法もあるが、
            // 今回は対象漢字以外は表示しないのでシンプルに
            // 個別ルビが難しいのでスキップ
            result.push(k);
          }
        }
      }

      sIdx = kanjiEndIdx;
      hIdx = hEnd;
    } else {
      // 非漢字はそのまま
      result.push(sChar);
      sIdx++;
      hIdx++;
    }
  }

  return result.join('');
}

// もっとシンプルなアプローチ: 1文字ずつ処理
function generateRubySimple(sentence, hiragana, targetKanji) {
  if (!hiragana) return sentence;

  let result = '';
  let hIdx = 0;

  for (let sIdx = 0; sIdx < sentence.length; sIdx++) {
    const sChar = sentence[sIdx];

    if (!isKanji(sChar)) {
      // 非漢字はそのまま追加
      result += sChar;
      hIdx++;
    } else {
      // 漢字の場合
      // ひらがな版で対応する読みを抽出
      const rubyStart = hIdx;

      // 次の文字を確認
      const nextSChar = sentence[sIdx + 1];

      // nextSCharがひらがな版に現れるまでスキップ
      while (hIdx < hiragana.length) {
        // 次の原文文字とひらがな版が一致したら終了
        if (nextSChar !== undefined && hiragana[hIdx] === nextSChar) {
          break;
        }
        // または、連続した漢字の場合は次の漢字の読み開始位置を推測
        if (nextSChar !== undefined && isKanji(nextSChar)) {
          // 次も漢字なら、読みの区切りを推測（難しい）
          // 簡易的に: ひらがなが続く限り進む
          if (isHiragana(hiragana[hIdx])) {
            hIdx++;
          } else {
            break;
          }
        } else {
          hIdx++;
        }
      }

      const ruby = hiragana.slice(rubyStart, hIdx);

      if (sChar === targetKanji) {
        result += sChar; // 対象漢字はルビなし
      } else if (ruby) {
        result += sChar + '[' + ruby + ']';
      } else {
        result += sChar;
      }
    }
  }

  return result;
}

// さらにシンプル: 位置同期方式
function generateRubyAligned(sentence, hiragana, targetKanji) {
  if (!hiragana) return sentence;

  // 非ひらがな・非漢字（記号・スペース等）を同期ポイントとして使用
  let result = '';
  let hIdx = 0;

  for (let sIdx = 0; sIdx < sentence.length; sIdx++) {
    const sChar = sentence[sIdx];

    if (!isKanji(sChar)) {
      // 非漢字
      result += sChar;
      // ひらがな版も同じ位置のはず
      if (hiragana[hIdx] === sChar) {
        hIdx++;
      } else {
        // 同期ずれ - ひらがな版でsCharを探す
        while (hIdx < hiragana.length && hiragana[hIdx] !== sChar) {
          hIdx++;
        }
        if (hIdx < hiragana.length) hIdx++;
      }
    } else {
      // 漢字
      const rubyStart = hIdx;

      // 原文の次の非漢字文字を見つける
      let nextSyncIdx = sIdx + 1;
      while (nextSyncIdx < sentence.length && isKanji(sentence[nextSyncIdx])) {
        nextSyncIdx++;
      }
      const nextSyncChar = sentence[nextSyncIdx]; // 次の非漢字、または undefined

      // ひらがな版で nextSyncChar まで進む
      if (nextSyncChar !== undefined) {
        while (hIdx < hiragana.length && hiragana[hIdx] !== nextSyncChar) {
          hIdx++;
        }
      } else {
        // 文末まで
        hIdx = hiragana.length;
      }

      const kanjiCount = nextSyncIdx - sIdx;
      const ruby = hiragana.slice(rubyStart, hIdx);

      // 漢字群全体の読みを取得
      // 各漢字に振り分け（難しいので、漢字1文字ずつ処理）
      if (kanjiCount === 1) {
        // 単独の漢字
        if (sChar === targetKanji) {
          result += sChar;
        } else {
          result += sChar + '[' + ruby + ']';
        }
      } else {
        // 複数漢字（熟語）
        const compound = sentence.slice(sIdx, nextSyncIdx);
        const compoundReading = compoundReadings[compound];

        if (compoundReading) {
          // 熟語辞書にある場合、各漢字に個別のルビを付ける
          for (let i = 0; i < kanjiCount; i++) {
            const k = sentence[sIdx + i];
            const r = compoundReading[k];
            if (k === targetKanji) {
              result += k;
            } else if (r) {
              result += k + '[' + r + ']';
            } else {
              result += k;
            }
          }
        } else {
          // 辞書にない場合は均等分割（フォールバック）
          const rubyPerKanji = Math.ceil(ruby.length / kanjiCount);
          for (let i = 0; i < kanjiCount; i++) {
            const k = sentence[sIdx + i];
            const r = ruby.slice(i * rubyPerKanji, (i + 1) * rubyPerKanji);
            if (k === targetKanji) {
              result += k;
            } else if (r) {
              result += k + '[' + r + ']';
            } else {
              result += k;
            }
          }
        }
        // インデックスを進める（ループで sIdx++ されるので -1 する）
        sIdx = nextSyncIdx - 1;
      }
    }
  }

  return result;
}

// examplesを更新
let updated = 0;
let missing = [];

for (const entry of examples) {
  for (const ex of entry.examples) {
    const hiragana = hiraganaMap[ex.sentence];
    if (hiragana) {
      ex.sentenceHiragana = hiragana;
      ex.sentenceWithRuby = generateRubyAligned(ex.sentence, hiragana, entry.character);
      updated++;
    } else {
      missing.push(ex.sentence);
      // ひらがながない場合は元のsentenceをそのまま使用
      ex.sentenceWithRuby = ex.sentence;
    }
  }
}

// 保存
fs.writeFileSync('./static/data/examples.json', JSON.stringify(examples, null, 2));

console.log('更新完了:', updated, '件');
console.log('未対応:', missing.length, '件');

// サンプル確認
console.log('\n=== サンプル確認 ===');
const testCases = [
  { sentence: '左右を みる。', target: '右' },
  { sentence: '大雨が きた。', target: '雨' },
  { sentence: '上下に うごく。', target: '下' },
  { sentence: '足音が きこえる。', target: '音' },
  { sentence: '女王の くに。', target: '王' }
];

for (const tc of testCases) {
  const hiragana = hiraganaMap[tc.sentence];
  const ruby = generateRubyAligned(tc.sentence, hiragana, tc.target);
  console.log('原文:', tc.sentence);
  console.log('ひらがな:', hiragana);
  console.log('ルビ付き:', ruby);
  console.log('');
}

if (missing.length > 0) {
  console.log('\n=== 未対応の文 ===');
  missing.forEach(s => console.log('  "' + s + '": "",'));
}
