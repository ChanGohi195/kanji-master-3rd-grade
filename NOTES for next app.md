# 漢字習熟アプリ データ作成ガイドライン

このドキュメントは、2年生版の開発で発見された問題点をもとに、他学年展開時に修正の要らないデータ構造を作成するためのガイドラインです。

---

## クイックチェックリスト（データ投入前）

データをコミットする前に、以下を確認してください：

- [ ] **送り仮名**: 動詞・形容詞の読みに `.` が含まれているか
- [ ] **targetWord**: 熟語を問う場合、readingは熟語全体の読みか
- [ ] **例文品質**: 文脈から意味が推測できる長さか
- [ ] **読み多様性**: 音読みのみの漢字に複数の熟語があるか
- [ ] **重複チェック**: 同じ漢字のex-1〜ex-5に重複がないか
- [ ] **typoチェック**: sentenceHiraganaに「かくく」のような重複文字がないか

---

## 1. データ構造仕様

### 1.1 送り仮名形式ルール

訓読みの動詞・形容詞では、読みに `.` を含めて送り仮名を区別する。

| 品詞 | 悪い例 | 良い例 |
|------|--------|--------|
| 動詞 | `"reading": "よむ"` | `"reading": "よ.む"` |
| 動詞 | `"reading": "かく"` | `"reading": "か.く"` |
| 動詞 | `"reading": "たべる"` | `"reading": "た.べる"` |
| 形容詞 | `"reading": "たかい"` | `"reading": "たか.い"` |
| 形容詞 | `"reading": "あたらしい"` | `"reading": "あたら.しい"` |

**理由**: `getStemReading()` 関数が `.` より前の部分を取得し、選択肢に表示する。送り仮名を含めた全体を選択肢にすると、答えが自明になってしまう。

### 1.2 targetWord使用ルール

熟語の読みを問う場合は `targetWord` フィールドを使用する。

```json
{
  "sentence": "電車で 学校に 行く。",
  "reading": "でんしゃ",
  "targetWord": "電車",
  "type": "on"
}
```

**重要**: `targetWord` がある場合、`reading` は熟語全体の読みにする。

| 悪い例 | 良い例 |
|--------|--------|
| `targetWord: "本当"`, `reading: "とう"` | `targetWord: "本当"`, `reading: "ほんとう"` |
| `targetWord: "当日"`, `reading: "とう"` | `targetWord: "当日"`, `reading: "とうじつ"` |
| `targetWord: "電車"`, `reading: "でん"` | `targetWord: "電車"`, `reading: "でんしゃ"` |

---

## 2. 例文作成ガイドライン

### 2.1 品質基準

例文は文脈から意味が推測できる程度の長さが必要。

| 悪い例 | 良い例 |
|--------|--------|
| 「当たりまえ。」 | 「それは 当たりまえの ことだ。」 |
| 「頭上に ある。」 | 「頭上に 星が 光る。」 |
| 「刀だ。」 | 「博物館で 刀を 見た。」 |

**目安**: 主語・目的語・述語が揃った文章にする。

### 2.2 避けるべき表現

小学生向けアプリのため、以下の表現は避ける：

- **暴力的表現**: 「敵を 切る」「刀で 斬る」
- **ネガティブすぎる表現**: 「死」「病気」に関する過度な描写
- **難解な概念**: 抽象的すぎて小学生に理解しづらい文章

**対策**: 日常的・教育的な文脈を使用する
- 刀 → 博物館、剣道、歴史の授業
- 切 → 紙を切る、野菜を切る

### 2.3 文脈の適切性

同じ漢字でも、例文ごとに異なる文脈を提供する。

**悪い例**（全て同じパターン）:
```
引く → 「ドアを 引く」「つなを 引く」「いすを 引く」「せんを 引く」
```

**良い例**（多様な文脈）:
```
引く → 「ドアを 引く」「引きだしを あける」「辞書で 引く」「風邪を 引く」
```

---

## 3. 読み設定ガイドライン

### 3.1 音読み・訓読みのバランス

1つの漢字に対して、音読み・訓読みの両方がある場合は両方を含める。

```
書 → 書く(か.く/訓)、図書(としょ/音)、読書(どくしょ/音)、書道(しょどう/音)
```

### 3.2 熟語の選定基準

音読みのみの漢字は単調になりがちなので、複数の熟語を使用する。

**悪い例**（単調）:
```
電 → 「電車」「電車」「電車」「電車」「電車」（全て同じ）
```

**良い例**（多様）:
```
電 → 「電車」「電気」「電話」「電池」「停電」（5種類の熟語）
```

**熟語選定の優先順位**:
1. 該当学年で習う漢字のみで構成される熟語
2. 日常生活で使用頻度の高い熟語
3. 意味が直感的に理解しやすい熟語

---

## 4. よくあるミスと対策

### 4.1 送り仮名の不統一

**発見パターン**: grepで `"reading": "[ぁ-ん]+"` を検索し、`.` が含まれていない訓読みを探す。

**修正コマンド例**:
```bash
# 形容詞の一括修正
sed -i 's/"reading": "たかい"/"reading": "たか.い"/g' examples.json
```

### 4.2 targetWordと読みの不整合

**発見パターン**: `targetWord` を持つエントリで、`reading` が1-2文字のものを探す。

**チェックポイント**:
- targetWordの文字数 ≒ readingの文字数（おおよそ一致すべき）

### 4.3 例文の品質問題

**発見パターン**: 文字数が極端に少ない例文（10文字以下など）

**チェックコマンド例**:
```bash
grep '"sentence":' examples.json | awk -F'"' '{if(length($4) < 10) print $4}'
```

### 4.4 typo・重複

**よくあるtypoパターン**:
- `かくく` （かく + く の重複）
- `たべるべる` （たべる + べる の重複）
- `はしるる` （はしる + る の重複）

**発見方法**: sentenceHiraganaで同じ2文字以上が連続するパターンを検索

**重複チェック**: 同じ漢字のexamplesで、sentence が完全一致するものがないか確認

---

## 5. ブランチ運用

他学年展開時も同じブランチ構成を推奨：

| ブランチ | 用途 |
|---------|------|
| main | ひらがな表記版（未習漢字をひらがなで表示） |
| feature/kanji-compound-display | 漢字表記版（すべて漢字で表示、ルビ付き） |

**注意**: 両ブランチで examples.json の構造は同じ。違いは `sentenceWithRuby` と `sentenceHiragana` のどちらを使用するか。

---

## 付録: データ構造テンプレート

```json
{
  "kanjiId": "U+XXXX",
  "character": "漢",
  "examples": [
    {
      "id": "U+XXXX-ex-1",
      "sentence": "例文を ここに 書く。",
      "reading": "よ.み",
      "type": "kun",
      "sentenceWithRuby": "例文[れいぶん]を ここに 書[か]く。",
      "sentenceHiragana": "れいぶんを ここに かく。"
    },
    {
      "id": "U+XXXX-ex-2",
      "sentence": "熟語を 使う。",
      "reading": "じゅくご",
      "type": "on",
      "targetWord": "熟語",
      "sentenceWithRuby": "熟語[じゅくご]を 使[つか]う。",
      "sentenceHiragana": "じゅくごを つかう。"
    }
  ]
}
```
